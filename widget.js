!function(){if(window.N8nChatWidgetLoaded)return;window.N8nChatWidgetLoaded=!0;const n=function n(e,t){const r={...e};for(const a in t)t[a]&&"object"==typeof t[a]&&!Array.isArray(t[a])?r[a]=n(e[a]||{},t[a]):void 0!==t[a]&&""!==t[a]&&(r[a]=t[a]);return r}({webhook:{url:"",route:"general"},branding:{botName:"Ben",botStatus:"Online",botAvatar:"",showBotAvatar:!0,welcomeTitle:"Hallo, ich bin Ben ğŸ‘‹",welcomeSubtitle:"Ihr persÃ¶nlicher KI-Steuerbot von Onlinesteuern.de",welcomeQuestion:"Wie kann ich Ihnen helfen?",welcomeButtonText:"Chat starten",inputPlaceholder:"Nachricht senden",launcherIcon:"chat",footerText:"",footerLink:"",showFooter:!1},portalButton:{enabled:!0,text:"Zum Mandantenportal",actionText:"Ã–ffnen",url:"https://ben.onlinesteuern.de",openInNewTab:!0},initialMessage:{enabled:!0,delay:500,message:""},messages:{errorTitle:"Konnte nicht antworten",errorGeneral:"Server error",errorNetwork:"Keine Verbindung zum Server",errorTimeout:"ZeitÃ¼berschreitung",errorRetry:"Erneut versuchen",formSubmitted:"âœ“ Gesendet"},colors:{primary:"#1a8a7d",primaryDark:"#15756a",background:"#ffffff",backgroundChat:"#f0f2f5",backgroundBotMessage:"#ffffff",textPrimary:"#1f2937",textSecondary:"#6b7280",textOnPrimary:"#ffffff",border:"#e5e7eb",buttonBackground:"#ffffff",buttonBorder:"#1a8a7d",buttonText:"#1a8a7d",buttonHoverBackground:"#1a8a7d",buttonHoverText:"#ffffff",formBorder:"#1a8a7d",formTitle:"#1a8a7d",statusOnline:"#22c55e",statusOffline:"#9ca3af",errorBackground:"#fff3cd",errorText:"#d63031",errorSubtext:"#856404"},layout:{position:"right",windowWidth:"420px",windowHeight:"600px",windowBottomOffset:"100px",windowSideOffset:"24px",launcherBottomOffset:"24px",launcherSideOffset:"24px",borderRadius:"16px"},typography:{fontFamily:"'Inter', -apple-system, BlinkMacSystemFont, sans-serif",fontUrl:"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"},behavior:{autoOpen:!1,autoOpenDelay:3e3,requestTimeout:3e4}},window.ChatWidgetConfig||{});if(!n.webhook.url)return void console.error("Chat Widget Error: webhook.url is required!");if(n.typography.fontUrl){const e=document.createElement("link");e.rel="stylesheet",e.href=n.typography.fontUrl,document.head.appendChild(e)}const e=document.createElement("style");e.textContent=`\n        .n8n-chat-widget * {\n            box-sizing: border-box;\n            margin: 0;\n            padding: 0;\n        }\n        .n8n-chat-widget {\n            --primary: ${n.colors.primary};\n            --primary-dark: ${n.colors.primaryDark};\n            --bg: ${n.colors.background};\n            --bg-chat: ${n.colors.backgroundChat};\n            --bg-bot: ${n.colors.backgroundBotMessage};\n            --text: ${n.colors.textPrimary};\n            --text-secondary: ${n.colors.textSecondary};\n            --text-on-primary: ${n.colors.textOnPrimary};\n            --border: ${n.colors.border};\n            --btn-bg: ${n.colors.buttonBackground};\n            --btn-border: ${n.colors.buttonBorder};\n            --btn-text: ${n.colors.buttonText};\n            --btn-hover-bg: ${n.colors.buttonHoverBackground};\n            --btn-hover-text: ${n.colors.buttonHoverText};\n            --form-border: ${n.colors.formBorder};\n            --form-title: ${n.colors.formTitle};\n            --status-online: ${n.colors.statusOnline};\n            --error-bg: ${n.colors.errorBackground};\n            --error-text: ${n.colors.errorText};\n            --error-subtext: ${n.colors.errorSubtext};\n            --radius: ${n.layout.borderRadius};\n            --font: ${n.typography.fontFamily};\n            font-family: var(--font);\n        }\n\n        /* â•â•â•â•â•â•â•â•â•â• CHAT WINDOW â•â•â•â•â•â•â•â•â•â• */\n        .n8n-chat-widget .chat-window {\n            position: fixed;\n            bottom: ${n.layout.windowBottomOffset};\n            ${n.layout.position}: ${n.layout.windowSideOffset};\n            z-index: 10000;\n            width: ${n.layout.windowWidth};\n            max-width: calc(100vw - 40px);\n            height: ${n.layout.windowHeight};\n            max-height: calc(100vh - 140px);\n            background: var(--bg);\n            border-radius: var(--radius);\n            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.15);\n            display: none;\n            flex-direction: column;\n            overflow: hidden;\n            transition: all 0.3s ease;\n        }\n        .n8n-chat-widget .chat-window.open {\n            display: flex;\n        }\n\n        /* â•â•â•â•â•â•â•â•â•â• HEADER â•â•â•â•â•â•â•â•â•â• */\n        .n8n-chat-widget .chat-header {\n            padding: 16px 20px;\n            background: linear-gradient(135deg, var(--primary), var(--primary-dark));\n            color: var(--text-on-primary);\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            flex-shrink: 0;\n        }\n        .n8n-chat-widget .chat-avatar {\n            width: 40px;\n            height: 40px;\n            border-radius: 50%;\n            background: rgba(255,255,255,0.2);\n            object-fit: cover;\n            border: 2px solid rgba(255,255,255,0.3);\n        }\n        .n8n-chat-widget .chat-header-info {\n            flex: 1;\n        }\n        .n8n-chat-widget .chat-header-name {\n            font-weight: 600;\n            font-size: 15px;\n        }\n        .n8n-chat-widget .chat-header-status {\n            font-size: 12px;\n            opacity: 0.9;\n            display: flex;\n            align-items: center;\n            gap: 6px;\n        }\n        .n8n-chat-widget .status-dot {\n            width: 8px;\n            height: 8px;\n            border-radius: 50%;\n            background: var(--status-online);\n        }\n        .n8n-chat-widget .chat-close {\n            background: rgba(255,255,255,0.2);\n            border: none;\n            color: var(--text-on-primary);\n            width: 32px;\n            height: 32px;\n            border-radius: 8px;\n            cursor: pointer;\n            font-size: 20px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            transition: background 0.2s;\n        }\n        .n8n-chat-widget .chat-close:hover {\n            background: rgba(255,255,255,0.3);\n        }\n\n        /* â•â•â•â•â•â•â•â•â•â• WELCOME SCREEN â•â•â•â•â•â•â•â•â•â• */\n        .n8n-chat-widget .welcome-screen {\n            flex: 1;\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n            padding: 32px;\n            text-align: center;\n            background: var(--bg-chat);\n        }\n        .n8n-chat-widget .welcome-screen.hidden {\n            display: none;\n        }\n        .n8n-chat-widget .welcome-avatar {\n            width: 90px;\n            height: 90px;\n            border-radius: 50%;\n            object-fit: cover;\n            margin-bottom: 16px;\n            box-shadow: 0 4px 12px rgba(0,0,0,0.12);\n            border: 3px solid var(--bg);\n        }\n        .n8n-chat-widget .welcome-title {\n            font-size: 20px;\n            font-weight: 600;\n            color: var(--text);\n            margin-bottom: 4px;\n        }\n        .n8n-chat-widget .welcome-subtitle {\n            font-size: 14px;\n            color: var(--text-secondary);\n            margin-bottom: 6px;\n        }\n        .n8n-chat-widget .welcome-subtitle-small {\n            font-size: 14px;\n            color: var(--text-secondary);\n            margin-bottom: 24px;\n        }\n        .n8n-chat-widget .welcome-start {\n            padding: 14px 28px;\n            background: linear-gradient(135deg, var(--primary), var(--primary-dark));\n            color: var(--text-on-primary);\n            border: none;\n            border-radius: 12px;\n            font-size: 15px;\n            font-weight: 600;\n            cursor: pointer;\n            font-family: inherit;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            transition: transform 0.2s, box-shadow 0.2s;\n        }\n        .n8n-chat-widget .welcome-start:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 4px 12px rgba(26, 138, 125, 0.4);\n        }\n        .n8n-chat-widget .welcome-portal {\n            margin-top: 12px;\n            padding: 12px 28px;\n            background: var(--bg);\n            color: var(--primary);\n            border: 1.5px solid var(--primary);\n            border-radius: 12px;\n            font-size: 14px;\n            font-weight: 600;\n            cursor: pointer;\n            font-family: inherit;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            text-decoration: none;\n            transition: all 0.2s;\n        }\n        .n8n-chat-widget .welcome-portal:hover {\n            background: var(--primary);\n            color: var(--text-on-primary);\n            transform: translateY(-2px);\n            box-shadow: 0 4px 12px rgba(26, 138, 125, 0.3);\n        }\n        .n8n-chat-widget .welcome-portal svg {\n            width: 16px;\n            height: 16px;\n        }\n        .n8n-chat-widget .welcome-portal.hidden {\n            display: none;\n        }\n        .n8n-chat-widget .welcome-start svg {\n            width: 20px;\n            height: 20px;\n        }\n\n        /* â•â•â•â•â•â•â•â•â•â• CHAT BODY â•â•â•â•â•â•â•â•â•â• */\n        .n8n-chat-widget .chat-body {\n            flex: 1;\n            display: none;\n            flex-direction: column;\n            min-height: 0;\n        }\n        .n8n-chat-widget .chat-body.active {\n            display: flex;\n        }\n\n        /* â•â•â•â•â•â•â•â•â•â• MESSAGES â•â•â•â•â•â•â•â•â•â• */\n        .n8n-chat-widget .chat-messages {\n            flex: 1;\n            overflow-y: auto;\n            padding: 20px;\n            background: var(--bg-chat);\n            display: flex;\n            flex-direction: column;\n            gap: 12px;\n        }\n        .n8n-chat-widget .chat-messages::-webkit-scrollbar {\n            width: 6px;\n        }\n        .n8n-chat-widget .chat-messages::-webkit-scrollbar-thumb {\n            background: rgba(0,0,0,0.1);\n            border-radius: 3px;\n        }\n\n        /* â•â•â•â•â•â•â•â•â•â• MESSAGE BUBBLES â•â•â•â•â•â•â•â•â•â• */\n        .n8n-chat-widget .message {\n            max-width: 85%;\n            padding: 12px 16px;\n            border-radius: 16px;\n            font-size: 14px;\n            line-height: 1.5;\n            word-wrap: break-word;\n        }\n        .n8n-chat-widget .message.user {\n            align-self: flex-end;\n            background: linear-gradient(135deg, var(--primary), var(--primary-dark));\n            color: var(--text-on-primary);\n            border-bottom-right-radius: 4px;\n        }\n        .n8n-chat-widget .message.bot {\n            align-self: flex-start;\n            background: var(--bg-bot);\n            color: var(--text);\n            border-bottom-left-radius: 4px;\n            box-shadow: 0 1px 2px rgba(0,0,0,0.05);\n        }\n        .n8n-chat-widget .message.error {\n            background: var(--error-bg);\n            border: none;\n            color: var(--text);\n            border-radius: 16px;\n            border-bottom-left-radius: 4px;\n            box-shadow: 0 1px 2px rgba(0,0,0,0.05);\n        }\n        .n8n-chat-widget .message.error .error-title {\n            font-weight: 600;\n            color: var(--error-text);\n            margin-bottom: 2px;\n        }\n        .n8n-chat-widget .message.error .error-detail {\n            color: var(--error-subtext);\n            font-size: 13px;\n        }\n        .n8n-chat-widget .message.error .error-retry {\n            color: var(--primary);\n            text-decoration: underline;\n            cursor: pointer;\n            font-size: 13px;\n            margin-top: 4px;\n            display: inline-block;\n        }\n        .n8n-chat-widget .message.error .error-retry:hover {\n            color: var(--primary-dark);\n        }\n        .n8n-chat-widget .message strong {\n            font-weight: 600;\n        }\n        .n8n-chat-widget .message a {\n            color: var(--primary);\n            text-decoration: underline;\n        }\n        .n8n-chat-widget .message.user a {\n            color: var(--text-on-primary);\n        }\n\n        /* â•â•â•â•â•â•â•â•â•â• SHARED BUTTON STYLE â•â•â•â•â•â•â•â•â•â• */\n        .n8n-chat-widget .quick-reply-btn,\n        .n8n-chat-widget .action-btn {\n            padding: 10px 18px;\n            background: var(--bg);\n            border: 1.5px solid var(--border);\n            border-radius: 10px;\n            color: var(--text);\n            font-size: 14px;\n            font-weight: 500;\n            cursor: pointer;\n            transition: all 0.2s ease;\n            font-family: inherit;\n            box-shadow: 0 1px 3px rgba(0,0,0,0.06);\n        }\n        .n8n-chat-widget .quick-reply-btn:hover,\n        .n8n-chat-widget .action-btn:hover {\n            background: var(--primary);\n            color: var(--text-on-primary);\n            border-color: var(--primary);\n            box-shadow: 0 2px 8px rgba(26, 138, 125, 0.25);\n            transform: translateY(-1px);\n        }\n        .n8n-chat-widget .quick-reply-btn:active,\n        .n8n-chat-widget .action-btn:active {\n            transform: translateY(0);\n            box-shadow: 0 1px 2px rgba(0,0,0,0.08);\n        }\n        .n8n-chat-widget .quick-reply-btn.clicked,\n        .n8n-chat-widget .action-btn.clicked {\n            opacity: 0.5;\n            pointer-events: none;\n        }\n\n        /* â•â•â•â•â•â•â•â•â•â• QUICK REPLIES â•â•â•â•â•â•â•â•â•â• */\n        .n8n-chat-widget .quick-replies {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 8px;\n            align-self: flex-start;\n            max-width: 85%;\n        }\n\n        /* â•â•â•â•â•â•â•â•â•â• ACTION BUTTONS â•â•â•â•â•â•â•â•â•â• */\n        .n8n-chat-widget .action-buttons {\n            display: flex;\n            flex-direction: column;\n            gap: 8px;\n            align-self: flex-start;\n            max-width: 85%;\n        }\n        .n8n-chat-widget .action-btn {\n            text-align: left;\n        }\n\n        /* â•â•â•â•â•â•â•â•â•â• DYNAMIC FORM â•â•â•â•â•â•â•â•â•â• */\n        .n8n-chat-widget .dynamic-form {\n            align-self: flex-start;\n            width: 100%;\n            max-width: 100%;\n            background: var(--bg);\n            border: 2px solid var(--form-border);\n            border-radius: 12px;\n            padding: 16px;\n        }\n        .n8n-chat-widget .form-title {\n            font-size: 15px;\n            font-weight: 600;\n            color: var(--form-title);\n            margin-bottom: 16px;\n            text-align: center;\n        }\n        .n8n-chat-widget .form-grid {\n            display: grid;\n            gap: 12px;\n        }\n        .n8n-chat-widget .form-grid.cols-2 {\n            grid-template-columns: repeat(2, 1fr);\n        }\n        @media (max-width: 500px) {\n            .n8n-chat-widget .form-grid.cols-2 {\n                grid-template-columns: 1fr;\n            }\n        }\n        .n8n-chat-widget .form-field {\n            display: flex;\n            flex-direction: column;\n            gap: 4px;\n        }\n        .n8n-chat-widget .form-field.full-width {\n            grid-column: 1 / -1;\n        }\n        .n8n-chat-widget .form-label {\n            font-size: 12px;\n            font-weight: 500;\n            color: var(--text);\n        }\n        .n8n-chat-widget .form-label.required::after {\n            content: ' *';\n            color: #ef4444;\n        }\n        .n8n-chat-widget .form-input,\n        .n8n-chat-widget .form-select,\n        .n8n-chat-widget .form-textarea {\n            padding: 10px 12px;\n            border: 1px solid var(--border);\n            border-radius: 8px;\n            font-size: 14px;\n            font-family: inherit;\n            background: var(--bg);\n            color: var(--text);\n            width: 100%;\n            transition: border-color 0.2s, box-shadow 0.2s;\n        }\n        .n8n-chat-widget .form-input:focus,\n        .n8n-chat-widget .form-select:focus,\n        .n8n-chat-widget .form-textarea:focus {\n            outline: none;\n            border-color: var(--primary);\n            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);\n        }\n        .n8n-chat-widget .form-textarea {\n            resize: vertical;\n            min-height: 80px;\n        }\n        .n8n-chat-widget .option-group {\n            display: flex;\n            flex-direction: column;\n            gap: 8px;\n        }\n        .n8n-chat-widget .option-item {\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            cursor: pointer;\n        }\n        .n8n-chat-widget .option-item input {\n            width: 18px;\n            height: 18px;\n            accent-color: var(--primary);\n        }\n        .n8n-chat-widget .option-item span {\n            font-size: 14px;\n            color: var(--text);\n        }\n        .n8n-chat-widget .range-container {\n            display: flex;\n            flex-direction: column;\n            gap: 4px;\n        }\n        .n8n-chat-widget .range-input {\n            width: 100%;\n            accent-color: var(--primary);\n        }\n        .n8n-chat-widget .range-value {\n            font-size: 12px;\n            color: var(--text-secondary);\n            text-align: center;\n        }\n        .n8n-chat-widget .form-submit {\n            margin-top: 16px;\n            padding: 12px 24px;\n            background: linear-gradient(135deg, var(--primary), var(--primary-dark));\n            color: var(--text-on-primary);\n            border: none;\n            border-radius: 10px;\n            font-size: 14px;\n            font-weight: 600;\n            cursor: pointer;\n            font-family: inherit;\n            display: block;\n            width: auto;\n            min-width: 120px;\n            margin-left: auto;\n            margin-right: auto;\n            transition: transform 0.2s;\n        }\n        .n8n-chat-widget .form-submit:hover {\n            transform: translateY(-1px);\n        }\n        .n8n-chat-widget .form-submit:disabled {\n            opacity: 0.6;\n            cursor: not-allowed;\n            transform: none;\n        }\n        .n8n-chat-widget .dynamic-form.submitted {\n            opacity: 0.7;\n            pointer-events: none;\n        }\n\n        /* â•â•â•â•â•â•â•â•â•â• TYPING INDICATOR â•â•â•â•â•â•â•â•â•â• */\n        .n8n-chat-widget .typing {\n            display: flex;\n            gap: 4px;\n            padding: 12px 16px;\n            background: var(--bg-bot);\n            border-radius: 16px;\n            border-bottom-left-radius: 4px;\n            align-self: flex-start;\n            box-shadow: 0 1px 2px rgba(0,0,0,0.05);\n        }\n        .n8n-chat-widget .typing-dot {\n            width: 8px;\n            height: 8px;\n            background: var(--primary);\n            border-radius: 50%;\n            animation: n8nTyping 1.4s infinite ease-in-out;\n        }\n        .n8n-chat-widget .typing-dot:nth-child(2) { animation-delay: 0.2s; }\n        .n8n-chat-widget .typing-dot:nth-child(3) { animation-delay: 0.4s; }\n        @keyframes n8nTyping {\n            0%, 60%, 100% { transform: translateY(0); }\n            30% { transform: translateY(-4px); }\n        }\n\n        /* â•â•â•â•â•â•â•â•â•â• INPUT AREA â•â•â•â•â•â•â•â•â•â• */\n        .n8n-chat-widget .chat-input-area {\n            padding: 16px;\n            background: var(--bg);\n            border-top: 1px solid var(--border);\n            display: flex;\n            gap: 10px;\n            flex-shrink: 0;\n        }\n        .n8n-chat-widget .chat-input {\n            flex: 1;\n            padding: 12px 16px;\n            border: 1px solid var(--border);\n            border-radius: 24px;\n            background: var(--bg);\n            color: var(--text);\n            font-size: 14px;\n            font-family: inherit;\n            resize: none;\n            max-height: 100px;\n            min-height: 44px;\n            line-height: 1.4;\n        }\n        .n8n-chat-widget .chat-input:focus {\n            outline: none;\n            border-color: var(--primary);\n        }\n        .n8n-chat-widget .chat-input::placeholder {\n            color: var(--text-secondary);\n        }\n        .n8n-chat-widget .chat-send {\n            width: 44px;\n            height: 44px;\n            background: linear-gradient(135deg, var(--primary), var(--primary-dark));\n            border: none;\n            border-radius: 50%;\n            color: var(--text-on-primary);\n            cursor: pointer;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            flex-shrink: 0;\n            transition: transform 0.2s;\n        }\n        .n8n-chat-widget .chat-send:hover {\n            transform: scale(1.05);\n        }\n        .n8n-chat-widget .chat-send svg {\n            width: 20px;\n            height: 20px;\n        }\n\n        /* â•â•â•â•â•â•â•â•â•â• FOOTER â•â•â•â•â•â•â•â•â•â• */\n        .n8n-chat-widget .chat-footer {\n            padding: 10px;\n            text-align: center;\n            background: var(--bg);\n            border-top: 1px solid var(--border);\n            flex-shrink: 0;\n        }\n        .n8n-chat-widget .chat-footer.hidden {\n            display: none;\n        }\n        .n8n-chat-widget .chat-footer a {\n            color: var(--text-secondary);\n            text-decoration: none;\n            font-size: 11px;\n        }\n        .n8n-chat-widget .chat-footer a:hover {\n            color: var(--primary);\n        }\n\n        /* â•â•â•â•â•â•â•â•â•â• PORTAL BUTTON â•â•â•â•â•â•â•â•â•â• */\n        .n8n-chat-widget .portal-button {\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n            padding: 14px 20px;\n            background: var(--primary);\n            color: var(--text-on-primary);\n            border: none;\n            cursor: pointer;\n            font-family: inherit;\n            font-size: 14px;\n            font-weight: 600;\n            flex-shrink: 0;\n            transition: background 0.2s;\n            text-decoration: none;\n            border-radius: 0 0 var(--radius) var(--radius);\n        }\n        .n8n-chat-widget .portal-button:hover {\n            background: var(--primary-dark);\n        }\n        .n8n-chat-widget .portal-button .portal-label {\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n        .n8n-chat-widget .portal-button .portal-action {\n            display: flex;\n            align-items: center;\n            gap: 6px;\n            font-weight: 500;\n            font-size: 13px;\n            opacity: 0.9;\n        }\n        .n8n-chat-widget .portal-button .portal-action svg {\n            width: 16px;\n            height: 16px;\n        }\n        .n8n-chat-widget .portal-button.hidden {\n            display: none;\n        }\n\n        /* â•â•â•â•â•â•â•â•â•â• TIMESTAMP â•â•â•â•â•â•â•â•â•â• */\n        .n8n-chat-widget .message-time {\n            font-size: 11px;\n            color: var(--text-secondary);\n            margin-top: 4px;\n            align-self: flex-start;\n        }\n        .n8n-chat-widget .message-time.user-time {\n            align-self: flex-end;\n        }\n\n        /* â•â•â•â•â•â•â•â•â•â• BOT AVATAR IN MESSAGES â•â•â•â•â•â•â•â•â•â• */\n        .n8n-chat-widget .message-row {\n            display: flex;\n            align-items: flex-end;\n            gap: 8px;\n            max-width: 85%;\n        }\n        .n8n-chat-widget .message-row.bot-row {\n            align-self: flex-start;\n        }\n        .n8n-chat-widget .message-row.user-row {\n            align-self: flex-end;\n            flex-direction: row-reverse;\n        }\n        .n8n-chat-widget .message-row .msg-avatar {\n            width: 28px;\n            height: 28px;\n            border-radius: 50%;\n            background: var(--primary);\n            flex-shrink: 0;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        }\n        .n8n-chat-widget .message-row .msg-avatar img {\n            width: 28px;\n            height: 28px;\n            border-radius: 50%;\n            object-fit: cover;\n        }\n        .n8n-chat-widget .message-row .msg-avatar-placeholder {\n            width: 28px;\n            height: 28px;\n            border-radius: 50%;\n            background: transparent;\n            flex-shrink: 0;\n        }\n\n        /* â•â•â•â•â•â•â•â•â•â• LAUNCHER â•â•â•â•â•â•â•â•â•â• */\n        .n8n-chat-widget .chat-launcher {\n            position: fixed;\n            bottom: ${n.layout.launcherBottomOffset};\n            ${n.layout.position}: ${n.layout.launcherSideOffset};\n            z-index: 9999;\n            width: 56px;\n            height: 56px;\n            padding: 0;\n            background: linear-gradient(135deg, var(--primary), var(--primary-dark));\n            color: var(--text-on-primary);\n            border: none;\n            border-radius: 50%;\n            cursor: pointer;\n            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-family: inherit;\n            transition: transform 0.2s, box-shadow 0.2s;\n        }\n        .n8n-chat-widget .chat-launcher:hover {\n            transform: scale(1.05);\n            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);\n        }\n        .n8n-chat-widget .chat-launcher svg {\n            width: 24px;\n            height: 24px;\n        }\n        .n8n-chat-widget .chat-launcher .launcher-icon-close {\n            display: none;\n        }\n        .n8n-chat-widget .chat-launcher.is-open .launcher-icon-chat {\n            display: none;\n        }\n        .n8n-chat-widget .chat-launcher.is-open .launcher-icon-close {\n            display: block;\n        }\n    `,document.head.appendChild(e);let t="",r=!1;const a=document.createElement("div");a.className="n8n-chat-widget";const o=n.branding.showBotAvatar&&n.branding.botAvatar?`<img class="chat-avatar" src="${n.branding.botAvatar}" alt="${n.branding.botName}">`:'<div class="chat-avatar" style="display:flex;align-items:center;justify-content:center;font-size:18px;background:rgba(255,255,255,0.2);">ğŸ¤–</div>',i=n.branding.showFooter?"":" hidden",s=n.portalButton.enabled?"":" hidden",l=n.portalButton.openInNewTab?' target="_blank" rel="noopener noreferrer"':"";a.innerHTML=`\n        <div class="chat-window">\n            <div class="chat-header">\n                ${o}\n                <div class="chat-header-info">\n                    <div class="chat-header-name">${n.branding.botName}</div>\n                    <div class="chat-header-status">\n                        <span class="status-dot"></span>\n                        ${n.branding.botStatus}\n                    </div>\n                </div>\n                <button class="chat-close">&times;</button>\n            </div>\n\n            <div class="welcome-screen">\n                ${n.branding.botAvatar?`<img class="welcome-avatar" src="${n.branding.botAvatar}" alt="${n.branding.botName}">`:""}\n                <div class="welcome-title">${n.branding.welcomeTitle}</div>\n                <div class="welcome-subtitle">${n.branding.welcomeSubtitle}</div>\n                <div class="welcome-subtitle-small">${n.branding.welcomeQuestion||""}</div>\n                <button class="welcome-start">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>\n                    </svg>\n                    ${n.branding.welcomeButtonText}\n                </button>\n                <a class="welcome-portal${s}" href="${n.portalButton.url}"${l}>\n                    ${n.portalButton.text}\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>\n                        <polyline points="15 3 21 3 21 9"></polyline>\n                        <line x1="10" y1="14" x2="21" y2="3"></line>\n                    </svg>\n                </a>\n            </div>\n\n            <div class="chat-body">\n                <div class="chat-messages"></div>\n                <div class="chat-input-area">\n                    <textarea class="chat-input" placeholder="${n.branding.inputPlaceholder}" rows="1"></textarea>\n                    <button class="chat-send">\n                        <svg viewBox="0 0 24 24" fill="currentColor" stroke="none">\n                            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>\n                        </svg>\n                    </button>\n                </div>\n                <a class="portal-button${s}" href="${n.portalButton.url}"${l}>\n                    <span class="portal-label">${n.portalButton.text}</span>\n                    <span class="portal-action">\n                        ${n.portalButton.actionText}\n                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>\n                            <polyline points="15 3 21 3 21 9"></polyline>\n                            <line x1="10" y1="14" x2="21" y2="3"></line>\n                        </svg>\n                    </span>\n                </a>\n                <div class="chat-footer${i}">\n                    <a href="${n.branding.footerLink}" target="_blank">${n.branding.footerText}</a>\n                </div>\n            </div>\n        </div>\n\n        <button class="chat-launcher">\n            <svg class="launcher-icon-chat" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>\n            </svg>\n            <svg class="launcher-icon-close" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">\n                <line x1="18" y1="6" x2="6" y2="18"></line>\n                <line x1="6" y1="6" x2="18" y2="18"></line>\n            </svg>\n        </button>\n    `,document.body.appendChild(a);const c=a.querySelector(".chat-window"),d=a.querySelector(".welcome-screen"),p=a.querySelector(".chat-body"),g=a.querySelector(".chat-messages"),h=a.querySelector(".chat-input"),m=a.querySelector(".chat-send"),u=a.querySelector(".chat-launcher"),x=a.querySelector(".chat-close"),f=a.querySelector(".welcome-start");function b(){const n=new Date;return n.getHours().toString().padStart(2,"0")+":"+n.getMinutes().toString().padStart(2,"0")}function w(n){let e=n;const t=[],r=[];let a=null;const o=/\{([^}]+)\}/g;let i;for(;null!==(i=o.exec(n));){const n=i[1].split("|").map(n=>n.trim()).filter(n=>n);t.push(...n)}e=e.replace(o,"");const s=/\[([^\]]+)\]\s*=\s*\[([^\]]+)\]/g;let l;for(;null!==(l=s.exec(n));)r.push({label:l[1].trim(),value:l[2].trim()});e=e.replace(s,"");const c=/\[FORM\]([\s\S]*?)\[\/FORM\]/i,d=n.match(c);if(d)try{a=JSON.parse(d[1].trim())}catch(n){console.error("Invalid form JSON:",n)}return e=e.replace(c,""),e=e.replace(/\n{3,}/g,"\n\n").trim(),{text:e,quickReplies:t,actionButtons:r,form:a}}function v(n){return n.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br>").replace(/(https?:\/\/[^\s<]+)/g,'<a href="$1" target="_blank">$1</a>')}function y(e,t=!1,r=!1){if(t||r){if(t){const n=document.createElement("div");n.className="message user",n.innerHTML=v(e),g.appendChild(n)}}else{const t=document.createElement("div");t.className="message-row bot-row";const r=document.createElement("div");if(n.branding.showBotAvatar&&n.branding.botAvatar){r.className="msg-avatar";const e=document.createElement("img");e.src=n.branding.botAvatar,e.alt=n.branding.botName,r.appendChild(e)}else r.className="msg-avatar",r.textContent="ğŸ¤–",r.style.fontSize="14px";const a=document.createElement("div");a.className="message bot",a.innerHTML=v(e),t.appendChild(r),t.appendChild(a),g.appendChild(t)}const a=document.createElement("div");a.className="message-time"+(t?" user-time":""),a.textContent=b(),g.appendChild(a),g.scrollTop=g.scrollHeight}function k(n){if(!n.length)return;const e=document.createElement("div");e.className="quick-replies",n.forEach(n=>{const t=document.createElement("button");t.className="quick-reply-btn",t.textContent=n,t.onclick=()=>{e.querySelectorAll(".quick-reply-btn").forEach(n=>n.classList.add("clicked")),T(n)},e.appendChild(t)}),g.appendChild(e),g.scrollTop=g.scrollHeight}function $(n){if(!n.length)return;const e=document.createElement("div");e.className="action-buttons",n.forEach(n=>{const t=document.createElement("button");t.className="action-btn",t.textContent=n.label,t.onclick=()=>{e.querySelectorAll(".action-btn").forEach(n=>n.classList.add("clicked")),T(n.value)},e.appendChild(t)}),g.appendChild(e),g.scrollTop=g.scrollHeight}function E(e){if(!e)return;const t=document.createElement("div");t.className="dynamic-form";const r=2===(e.columns||1)?"cols-2":"";let a=e.title?`<div class="form-title">${e.title}</div>`:"";a+=`<form class="form-grid ${r}">`,e.fields.forEach(n=>{const e=n.fullWidth||["textarea","radio","checkbox"].includes(n.type),t=n.required?"required":"";switch(a+=`<div class="form-field ${e?"full-width":""}">`,a+=`<label class="form-label ${t}">${n.label}</label>`,n.type){case"select":a+=`<select class="form-select" name="${n.name}" ${n.required?"required":""}>`,a+=`<option value="">${n.placeholder||"Bitte wÃ¤hlen..."}</option>`,(n.options||[]).forEach(n=>{a+=`<option value="${n}">${n}</option>`}),a+="</select>";break;case"textarea":a+=`<textarea class="form-textarea" name="${n.name}" placeholder="${n.placeholder||""}" rows="${n.rows||3}" ${n.required?"required":""}></textarea>`;break;case"radio":a+='<div class="option-group">',(n.options||[]).forEach((e,t)=>{a+=`<label class="option-item"><input type="radio" name="${n.name}" value="${e}" ${n.required&&0===t?"required":""}><span>${e}</span></label>`}),a+="</div>";break;case"checkbox":a+='<div class="option-group">',(n.options||[]).forEach(e=>{a+=`<label class="option-item"><input type="checkbox" name="${n.name}" value="${e}"><span>${e}</span></label>`}),a+="</div>";break;case"range":const e=n.min||0,t=n.max||100,r=n.default||Math.round((e+t)/2);a+='<div class="range-container">',a+=`<input type="range" class="range-input" name="${n.name}" min="${e}" max="${t}" value="${r}">`,a+=`<div class="range-value">${r}</div>`,a+="</div>";break;default:a+=`<input class="form-input" type="${n.type||"text"}" name="${n.name}" placeholder="${n.placeholder||""}" ${n.required?"required":""}>`}a+="</div>"}),a+=`<button type="submit" class="form-submit">${e.submitText||"Absenden"}</button>`,a+="</form>",t.innerHTML=a,t.querySelectorAll(".range-input").forEach(n=>{n.addEventListener("input",n=>{n.target.parentElement.querySelector(".range-value").textContent=n.target.value})}),t.querySelector("form").addEventListener("submit",r=>{r.preventDefault();const a=new FormData(r.target),o={};t.querySelectorAll('input[type="checkbox"]').forEach(n=>{o[n.name]||(o[n.name]=[])});for(const[n,t]of a.entries()){const r=e.fields.find(e=>e.name===n);r&&"checkbox"===r.type?(o[n]||(o[n]=[]),o[n].push(t)):o[n]=t}Object.keys(o).forEach(n=>{Array.isArray(o[n])&&(o[n]=o[n].join(", "))}),t.classList.add("submitted"),t.querySelector(".form-submit").textContent=n.messages.formSubmitted;let i=e.title?`ğŸ“‹ **${e.title}**\n\n`:"ğŸ“‹ **Formulardaten:**\n\n";e.fields.forEach(n=>{o[n.name]&&(i+=`**${n.label}:** ${o[n.name]}\n`)}),T(i.trim())}),g.appendChild(t),g.scrollTop=g.scrollHeight}async function T(e){if(r||!e.trim())return;r=!0,y(e,!0);const a=function(){const n=document.createElement("div");return n.className="typing",n.innerHTML='<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>',g.appendChild(n),g.scrollTop=g.scrollHeight,n}(),o=new AbortController,i=setTimeout(()=>o.abort(),n.behavior.requestTimeout);try{const r=await fetch(n.webhook.url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"sendMessage",sessionId:t,route:n.webhook.route,chatInput:e}),signal:o.signal});if(clearTimeout(i),a.remove(),!r.ok)throw new Error("HTTP "+r.status);const s=await r.json(),l=w(Array.isArray(s)?s[0].output:s.output);l.text&&y(l.text),l.quickReplies.length&&k(l.quickReplies),l.actionButtons.length&&$(l.actionButtons),l.form&&E(l.form)}catch(t){clearTimeout(i),a.remove();let r=n.messages.errorGeneral;"AbortError"===t.name?r=n.messages.errorTimeout:t.message.includes("fetch")&&(r=n.messages.errorNetwork),function(e,t){const r=document.createElement("div");r.className="message-row bot-row";const a=document.createElement("div");a.className="msg-avatar",a.textContent="ğŸ¤–",a.style.fontSize="14px";const o=document.createElement("div");o.className="message error";const i=document.createElement("div");i.className="error-title",i.textContent=n.messages.errorTitle;const s=document.createElement("div");s.className="error-detail",s.textContent=e;const l=document.createElement("div");l.className="error-retry",l.textContent=n.messages.errorRetry,l.addEventListener("click",()=>{const n=r.nextElementSibling;n&&n.classList.contains("message-time")&&n.remove(),r.remove(),t&&T(t)}),o.appendChild(i),o.appendChild(s),o.appendChild(l),r.appendChild(a),r.appendChild(o),g.appendChild(r);const c=document.createElement("div");c.className="message-time",c.textContent=b(),g.appendChild(c),g.scrollTop=g.scrollHeight}(r,e),console.error("Chat error:",t)}r=!1}u.addEventListener("click",function(){const n=c.classList.toggle("open");u.classList.toggle("is-open",n)}),x.addEventListener("click",()=>{c.classList.remove("open"),u.classList.remove("is-open")}),f.addEventListener("click",function(){t="sess_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),d.classList.add("hidden"),p.classList.add("active"),n.initialMessage.enabled&&n.initialMessage.message&&setTimeout(()=>{const e=w(n.initialMessage.message);e.text&&y(e.text),e.quickReplies.length&&k(e.quickReplies),e.actionButtons.length&&$(e.actionButtons),e.form&&E(e.form)},n.initialMessage.delay)}),m.addEventListener("click",()=>{T(h.value),h.value="",h.style.height="auto"}),h.addEventListener("keypress",n=>{"Enter"!==n.key||n.shiftKey||(n.preventDefault(),T(h.value),h.value="",h.style.height="auto")}),h.addEventListener("input",()=>{h.style.height="auto",h.style.height=Math.min(h.scrollHeight,100)+"px"}),n.behavior.autoOpen&&setTimeout(()=>{c.classList.add("open"),u.classList.add("is-open")},n.behavior.autoOpenDelay)}();